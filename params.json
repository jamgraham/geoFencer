{"name":"Adding Boundaries to MKMapView","body":"I worked on a project with a requirement to lock the boundaries of MKMapView. As there is no out-of-the-box solution provided by apple we are left subclassing MKMapView.  This is pretty easy and gives you access to the UIScrollView that lives in the map and other fun objects in the MKMapView.\r\n\r\nWant to look at the code now?  It's available here: https://github.com/jamgraham/geoFencer\r\n\r\nLocking the boundaries of the a MKMapView invokes two general steps.  First is to lock the zoom level to a min and max. Second is to prevent the user from scrolling outside the foundry you create.  Lets walk through these by looking at the delegates we need to override\r\n\r\n1. Zoom Level\r\n----------------\r\nThis is pretty straight forward.  The goal is the check the zoom level as the user zooms and again when the user stops zooming.\r\n\r\n     -(void)scrollViewDidZoom:(UIScrollView *)scrollView;\r\n     -(void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(UIView *)view atScale:(float)scale;\r\n\r\n2. Scrolling boundaries\r\n----------------\r\nThis is a bit more complex.  As the user scrolls around the map in the UIScrollView we want to make sure they do not go outside the boundaries and if they do we want to stop them.  We can achieve this by repositioning the map to the boundary when we see the user go outside the boundary.  This happens fast enough where the users feels like they've hit a wall rather than the map jerking around.  Here are the delegates we need to watch for:\r\n\r\n     -(void)scrollViewDidScroll:(UIScrollView *)scrollView;\r\n     -(void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView;\r\n\r\n\r\n3. Copy & Paste\r\n----------------\r\nFeel free to copy and paste the custom MKMapView below. In the UIViewController that show the map the custom map view needs the boundaries set\r\n\r\nViewController.m\r\n----------------\r\n\r\n\t\t//Set map boundaries\r\n\t\tmapView.showsUserLocation = YES;\r\n\t\t[mapViewsetZoomMax:0.015551];\r\n\t\t[mapViewsetZoomMin: 0.346360];\r\n\t\tmapView.top = 37.773498;\r\n\t\tmapView.bottom = 37.745130;\r\n\t\tmapView.left = -122.430365;\r\n\t\tmapView.right = -122.401623;\r\n\r\nGeoMapView.h\r\n----------------\r\n\r\n\t@interface GeoMapView : MKMapView\r\n\t{\r\n\t\tMKCoordinateRegion cordRegion;\r\n\t\tCLLocationCoordinate2D oldcenter;\r\n\t\tdouble left;\r\n\t\tdouble right;\r\n\t\tdouble top;\r\n\t\tdouble bottom;\r\n\t\tdouble zoomMax;\r\n\t\tdouble zoomMin;\r\n\t}\r\n\r\n\t-(void)checkZoom;\r\n\t-(void)checkScroll;\r\n\r\n\t@property (nonatomic) double left;\r\n\t@property (nonatomic) double right;\r\n\t@property (nonatomic) double top;\r\n\t@property (nonatomic) double bottom;\r\n\t@property (nonatomic) double zoomMax;\r\n\t@property (nonatomic) double zoomMin;\r\n\r\n\t@end\r\n\r\nGeoMapView.m\r\n----------------\r\n\r\n\t#import \"GeoMapView.h\"\r\n\r\n\t@implementation GeoMapView\r\n\t@synthesize  left, right, top, bottom,zoomMax,zoomMin;\r\n\r\n\t- (id)initWithFrame:(CGRect)frame\r\n\t{\r\n\t\tself = [superinitWithFrame:frame];\r\n\t\tif (self) {\r\n\r\n\t\t}\r\n\t\treturnself;\r\n\t}\r\n\r\n\t-(void)scrollViewDidZoom:(UIScrollView *)scrollView {\r\n\t\t[selfcheckZoom];    \r\n\t}\r\n\r\n\r\n\t-(void)checkZoom{\r\n\t\tUIScrollView * scroll = [[[[selfsubviews] objectAtIndex:0] subviews] objectAtIndex:0];\r\n\r\n\t\tif (scroll.zoomScale < zoomMax) {\r\n\t\t\tNSLog(@\"Reached Max Zoom\");\r\n\t\t\t[scroll setZoomScale:zoomMaxanimated:NO];\r\n\t\t}\r\n\r\n\t\tif (scroll.zoomScale >= zoomMin) {\r\n\t\t\tNSLog(@\"Reached Min Zoom\");\r\n\t\t\t[scroll setZoomScale:zoomMinanimated:NO];\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t-(void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(UIView *)view atScale:(float)scale\r\n\t{\r\n\t\tUIScrollView * scroll = [[[[selfsubviews] objectAtIndex:0] subviews] objectAtIndex:0];\r\n\r\n\t\tif (scroll.zoomScale > zoomMin) {\r\n\t\t\t[scroll setZoomScale:zoomMinanimated:NO];\r\n\t\t}   \r\n\t}\r\n\r\n\t-(void)scrollViewDidScroll:(UIScrollView *)scrollView {\r\n\r\n\t\t[selfcheckScroll];\r\n\r\n\t}\r\n\r\n\t-(void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView{\r\n\t\t[selfcheckScroll];\r\n\t}\r\n\r\n\t-(void)checkScroll{\r\n\t\t@try{\r\n\t\t\tcordRegion = self.region;\r\n\r\n\t\t\tCLLocationCoordinate2D center = self.region.center;\r\n\t\t\tCLLocationCoordinate2D northWestCorner, southEastCorner;\r\n\t\t\tnorthWestCorner.latitude  = center.latitude  + (self.region.span.latitudeDelta  / 2.0);\r\n\t\t\tnorthWestCorner.longitude = center.longitude - (self.region.span.longitudeDelta / 2.0);\r\n\t\t\tsouthEastCorner.latitude  = center.latitude  - (self.region.span.latitudeDelta  / 2.0);\r\n\t\t\tsouthEastCorner.longitude = center.longitude + (self.region.span.longitudeDelta / 2.0);\r\n\r\n\t\t\tCLLocationCoordinate2D newcenter;\r\n\t\t\tnewcenter.latitude = self.region.center.latitude;\r\n\t\t\tnewcenter.longitude = self.region.center.longitude;\r\n\r\n\t\t\t//LEFT\r\n\t\t\tCLLocationDegrees farLeft = left;\r\n\t\t\tCLLocationDegrees snapToLeft = farLeft + (self.region.span.longitudeDelta  / 2.0);\r\n\t\t\tif (northWestCorner.longitude < farLeft)\r\n\t\t\t{\r\n\t\t\t\tnewcenter.longitude = snapToLeft;\r\n\t\t\t\tcordRegion = self.region;\r\n\t\t\t}\r\n\r\n\t\t\t//RIGHT\r\n\t\t\tCLLocationDegrees r = (self.region.span.longitudeDelta / 2.0);\r\n\t\t\tCLLocationDegrees farRight = right;\r\n\t\t\tCLLocationDegrees snapToRight = farRight - r;\r\n\t\t\tif (southEastCorner.longitude > farRight)\r\n\t\t\t{\r\n\t\t\t\tnewcenter.longitude = snapToRight;\r\n\t\t\t}\r\n\r\n\t\t\t//TOP\r\n\t\t\tCLLocationDegrees farTop = top;\r\n\t\t\tCLLocationDegrees snapToTop = top - (self.region.span.latitudeDelta  / 2.0);\r\n\t\t\tif (northWestCorner.latitude > farTop)\r\n\t\t\t{\r\n\t\t\t\tnewcenter.latitude = snapToTop;\r\n\t\t\t}\r\n\r\n\t\t\t//BOTTOM\r\n\t\t\tCLLocationDegrees farBottom = bottom;\r\n\t\t\tCLLocationDegrees rr = (self.region.span.latitudeDelta  / 2.0);\r\n\t\t\tCLLocationDegrees snapToBottom = bottom + rr;\r\n\t\t\tif (southEastCorner.latitude < farBottom)\r\n\t\t\t{            \r\n\t\t\t\tnewcenter.latitude = snapToBottom;\r\n\t\t\t}\r\n\r\n\t\t\t[selfsetCenterCoordinate:newcenter  animated:NO];\r\n\r\n\t\t}\r\n\t\t@catch (NSException *e) {\r\n\t\t}\r\n\t\t@finally {}\r\n\t}\r\n\r\n\r\n\t@end\r\n\r\n\r\nIdeas\r\n----------------\r\nThere's a lot of cool stuff going on in geofencing right now. Some ideas:\r\n\r\n- Enter an address and lock  the map to that address\r\n- Geofencing with map overlays\r\n- Physical games that unlock areas of the map as the user actually visits those physical places.","tagline":"Geofencing with MKMapView","google":"UA-31278850-1","note":"Don't delete this file! It's used internally to help with page regeneration."}